@model IEnumerable<UvarTo.Models.Recipes>
<head>
    <link href="@Url.Content("~/css/Search.css")" rel="stylesheet" type="text/css" />

</head>



@{
    ViewData["Title"] = "Index";
}

<h1>Recipes</h1>
<div class="container">
    <div class="row no-border">
        @if (User.IsInRole("Admin") || User.IsInRole("User"))
        {
            <div class="col-md-4">
                <p>
                    <a asp-action="Create" class="btn btn-primary btn-block btn-custom">Create New</a>
                </p>
            </div>
        }

        @if (User.IsInRole("Admin") || User.IsInRole("User"))
        {
            <div class="col-md-4 offset-md-4 text-right-md">
                <!-- Add offset for the second column -->
                <p>
                    <a asp-action="UserItems" asp-controller="Recipes" class="btn btn-primary btn-block btn-custom">View My Recipes</a>
                </p>
            </div>
        }
    </div>
    <div class="row">
        <div class="col-md-3">
            <!-- Toggle Filter Button -->
            <button id="toggleFilterButton" class="btn btn-primary" onclick="toggleFilterForm()">Toggle Filter</button>
            <form id="filterForm" style="display: none;">
            <!-- Filter Form -->
            
                <div class="form-group">
                    <label for="difficultyFilter">Náročnost:</label>
                    <select id="difficultyFilter" class="form-control">
                        <option value="">Všechny</option>
                        @for (int i = 1; i <= 10; i++)
                        {
                            <option value="@i">@i</option>
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label for="cookTimeRangeFilter">Doba přípravy (minuty):</label>
                    <input type="range" id="cookTimeRangeFilter" min="0" max="120" step="1">
                    <span id="cookTimeRangeValue">0</span> minut
                </div>
                
                <div class="form-group">
                    <label for="categoryFilter">Kategorie:</label>
                    <select id="categoryFilter" class="form-control">
                        <option value="">Všechny</option>
                        <!-- Replace with your category options -->
                        <option value="Vegan">Veganské</option>
                        <option value="Vegetariánské">Vegetariánské</option>
                        <option value="Bezlepkové">Bezlepkové</option>
                    </select>
                </div>
                <div class="form-group">
                    <button id="filtrovat" type="button" class="btn btn-primary" onclick="filterRecipes()">Filtrovat</button>
                </div>
            </form>
        </div>
        <div class="col-md-9">
            <!-- Display Filtered Recipes -->
            @foreach (var item in Model)
            {
                <div class="recipe mb-4" data-difficulty="@item.Difficulty" data-cook-time="@item.CookTime" data-category="@item.RecipeCategory">
                    <div class="row">
                        <div class="col-md-4">
                            <img src="@item.ImageUrl" alt="Image" class="img-fluid" style="max-width: auto; height: 258px;">
                        </div>

                        <div class="col-md-8">
                            <p>@item.RecipeCategory</p>
                            @* <h3>@item.RecipeName</h3> *@
                            @* <h3 class="recipe-name-link">@Html.ActionLink(@item.RecipeName, "Edit", "Recipes")</h3>> *@
                            <h3 class="recipe-name-link">
                                <a asp-action="Details" asp-route-id="@item.Id">@item.RecipeName</a>
                            </h3>
                            <p>Popias: @item.RecipeText</p>
                            <p>Náročnost: @item.Difficulty</p>
                            <p>Doba přípravy: @item.CookTime Minut</p>
                            @if (User.IsInRole("Admin")){
                            <div class="button">
                                <a asp-action="Edit" asp-route-id="@item.Id" style="color: black">Edit</a> |
                                <a asp-action="Details" asp-route-id="@item.Id" style="color: black">Details</a> |
                                <a asp-action="Delete" asp-route-id="@item.Id" style="color: black">Delete</a>
                            </div>
                                }
                        </div>
                    </div>
                </div>
            }
        </div>
     </div>
 </div>



@section Scripts {
    <script>
        function filterRecipes() {
            var difficultyFilter = $("#difficultyFilter").val();
            var minTimeFilter = $("#cookTimeRangeFilter").attr("min");
            var maxTimeFilter = $("#cookTimeRangeFilter").val();
            var categoryFilter = $("#categoryFilter").val();

            // Display the selected cook time
            $("#cookTimeRangeValue").text(maxTimeFilter);

            $(".recipe").each(function () {
                var recipe = $(this);
                var recipeDifficulty = recipe.data("difficulty");
                var recipeCookTime = recipe.data("cook-time");
                var recipeCategory = recipe.data("category");

                // Check if the recipe matches the filter criteria
                var difficultyMatch = difficultyFilter === "" || recipeDifficulty === parseInt(difficultyFilter);
                var minTimeMatch = minTimeFilter === "" || recipeCookTime >= parseInt(minTimeFilter);
                var maxTimeMatch = maxTimeFilter === "" || recipeCookTime <= parseInt(maxTimeFilter);
                var categoryMatch = categoryFilter === "" || recipeCategory === categoryFilter;

                if (difficultyMatch && minTimeMatch && maxTimeMatch && categoryMatch) {
                    recipe.show();
                } else {
                    recipe.hide();
                }
            });
        }

        // Update the displayed value when the slider value changes
        $("#cookTimeRangeFilter").on("input", function () {
            $("#cookTimeRangeValue").text($(this).val());
        });

        function toggleFilterForm() {
            var filterForm = document.getElementById("filterForm");
            var toggleButton = document.getElementById("toggleFilterButton");

            if (filterForm.style.display === "none") {
                filterForm.style.display = "block";
                toggleButton.textContent = "Hide Filter";
            } else {
                filterForm.style.display = "none";
                toggleButton.textContent = "Show Filter";
            }
        }
    </script>
}
